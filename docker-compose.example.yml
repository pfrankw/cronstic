services:
  cronstic:
    image: ghcr.io/pfrankw/cronstic:latest
    init: true # without init it's not possible to stop the container with SIGTERM
    # env_file: restic.env # Better put restic vars into a separate file
    environment:
      RESTIC_HOST: example
      RESTIC_PASSWORD: secret
      RESTIC_REPOSITORY: s3:something.example.com/bucket
      AWS_ACCESS_KEY: ACCESSKEY
      AWS_SECRET_ACCESS_KEY: SECRETACCESSKEY
      BACKUP_VOLUMES_CRON: "0 0 * * *" # Backing up all mounted volumes at midnight
      COMMANDS_PRE: |-
        echo "Executing COMMANDS_PRE"

      COMMANDS_POST: |-
        echo "Executing COMMANDS_POST"

      COMMANDS_SUCCESS: |-
        echo "Executing COMMANDS_SUCCESS"

      COMMANDS_FAIL: |-
        echo "Executing COMMANDS_FAIL"

    volumes:
      - /var/run/docker.sock:/var/run/docker.sock # This is needed if you use BACKUP_VOLUMES_CRON
      - data:/volumes/data

  alpineone:
    image: alpine:3
    init: true
    volumes:
      - data:/data
    command: sh -c "while true; do sleep 1; done"

  albinetwo:
    image: alpine:3
    init: true
    volumes:
      - data:/data
    command: sh -c "while true; do sleep 1; done"

volumes:
  data:
